[build]
builder = "nixpacks"

[deploy]
startCommand = "uvicorn backend.main:app --host 0.0.0.0 --port $PORT --workers 1"
healthcheckPath = "/crm/health?provider=hubspot"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[deploy.services]
worker = "dramatiq backend.workers.crm_jobs -p 4"

[deploy.environment]
ENV = "production"
APP_BASE_URL = "https://api.agoralia.app"
FRONTEND_BASE_URL = "https://app.agoralia.app"
LOG_LEVEL = "INFO"
ENABLE_METRICS = "true"
ENABLE_CRM_SYNC = "true"
ENABLE_WEBHOOKS = "true"
ENABLE_POLLING = "true"

[env]
PYTHON_VERSION = "3.11"
