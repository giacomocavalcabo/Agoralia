[build]
builder = "nixpacks"

[deploy]
startCommand = "sh -c 'alembic upgrade head && exec uvicorn backend.main:app --host 0.0.0.0 --port $PORT --workers 1 --loop asyncio --http h11'"
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[deploy.services]
worker = "python -m backend.worker"

[deploy.environment]
ENV = "production"
APP_BASE_URL = "https://api.agoralia.app"
FRONTEND_BASE_URL = "https://app.agoralia.app"
LOG_LEVEL = "INFO"
ENABLE_METRICS = "true"
ENABLE_CRM_SYNC = "true"
ENABLE_WEBHOOKS = "true"
ENABLE_POLLING = "true"

[env]
PYTHON_VERSION = "3.11"
